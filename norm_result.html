<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>おみくじ結果 - 篠ノ井乗務区</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
:root { --red: #b71c1c; --bg: #fdfcf0; --gold: #b8860b; --green: #24b500; }
body { background: var(--bg); font-family: "BIZ UDPGothic", sans-serif; text-align: center; margin: 0; padding: 20px; -webkit-text-size-adjust: 100%; }

#screenshot-target { background: #fff; border: 3px solid var(--red); border-radius: 20px; padding: 30px 20px; max-width: 450px; margin: 20px auto; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
.unsei { font-size: 1.1rem; color: #666; margin-bottom: 5px; }
.rank { font-size: 3.8rem; font-weight: bold; color: var(--red); margin: 0; letter-spacing: 5px; }
.lucky-item { font-size: 1.3rem; font-weight: bold; color: #333; margin: 20px 0; padding: 12px; border-top: 2px solid #f0f0f0; border-bottom: 2px solid #f0f0f0; background: #fffaf0; }
.message { font-size: 0.95rem; line-height: 1.7; color: #444; text-align: left; padding: 0 10px; min-height: 80px; }
.site-url { font-size: 0.7rem; color: #ccc; margin-top: 15px; display: block; }

.btn-container { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; max-width: 450px; margin: 20px auto; }
.btn { display: flex; align-items: center; justify-content: center; padding: 15px 5px; color: #fff; text-decoration: none; border-radius: 12px; font-weight: bold; font-size: 0.9rem; border: none; cursor: pointer; transition: 0.2s; }
.btn:active { transform: scale(0.95); }

.btn-save { background: var(--gold); grid-column: span 2; font-size: 1.1rem; }
.btn-tw { background: #000; }
.btn-line { background: var(--green); }
.btn-retry { background: #666; grid-column: span 2; margin-top: 10px; }

footer { margin-top: 40px; font-size: 0.7rem; color: #999; }
</style>
</head>
<body>

<div id="screenshot-target">
    <div class="unsei">2026年 今日の運勢</div>
    <p id="rank-display" class="rank">...</p>
    <div id="item-display" class="lucky-item">...</div>
    <div id="msg-display" class="message"></div>
    <span class="site-url">篠ノ井乗務区 2周年特設サイト<br>https://shinorail.github.io/shinonoi-2026/</span>
</div>

<div class="btn-container">
    <button class="btn btn-save" onclick="saveImage()">画像を保存してシェア</button>
    <button class="btn btn-tw" onclick="shareX()">Xでシェア</button>
    <button class="btn btn-line" onclick="shareLine()">LINEで送る</button>
    <a href="index.html" class="btn btn-retry">トップへ戻る</a>
</div>

<footer>
    製造元：GitHub / 制作・著作：篠ノ井乗務区
</footer>

<script>
const results = [
    { rank: "大吉", item: "ラッキー：温かい蕎麦", msg: "運気は最高潮！何事もスムーズに進む一日。美味しい信州蕎麦を食べるとさらに運気がアップします。" },
    { rank: "中吉", item: "ラッキー：赤い小物", msg: "安定した運勢です。身の回りに赤いものを取り入れると、やる気が湧いて良い知らせが届くかも。" },
    { rank: "吉", item: "ラッキー：散歩", msg: "平穏で穏やかな一日。少し遠回りして歩いてみると、素敵な発見や新しいアイデアが浮かびそう。" },
    { rank: "小吉", item: "ラッキー：読書", msg: "自分磨きに適した日。静かな場所で本を読むと、将来に役立つ大切な知識が得られるでしょう。" },
    { rank: "末吉", item: "ラッキー：整理整頓", msg: "身の回りを片付けることで運気が開けます。まずは机の上から綺麗にしてみましょう。" }
];

// 1日1回制限
const today = new Date().toLocaleDateString();
const lastDate = localStorage.getItem('last_draw_norm');
let currentRes;

if (lastDate === today) {
    currentRes = JSON.parse(localStorage.getItem('saved_res_norm'));
    alert("おみくじは1日1回までです。本日の結果を表示します。");
} else {
    currentRes = results[Math.floor(Math.random() * results.length)];
    localStorage.setItem('last_draw_norm', today);
    localStorage.setItem('saved_res_norm', JSON.stringify(currentRes));
}

document.getElementById('rank-display').innerText = currentRes.rank;
document.getElementById('item-display').innerText = currentRes.item;
document.getElementById('msg-display').innerText = currentRes.msg;

function saveImage() {
    const target = document.getElementById("screenshot-target");
    html2canvas(target, { backgroundColor: "#fdfcf0", scale: 2 }).then(canvas => {
        const link = document.createElement("a");
        link.href = canvas.toDataURL("image/png");
        link.download = `shinorail_omikuji_${currentRes.rank}.png`;
        link.click();
        alert("画像を保存しました！");
    });
}

function shareX() {
    const text = `篠ノ井乗務区 おみくじ結果は【${currentRes.rank}】！\n${currentRes.item}\n#篠ノ井乗務区 #おみくじ\n`;
    const url = "https://shinorail.github.io/shinonoi-2026/";
    window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`, '_blank');
}

function shareLine() {
    const text = `篠ノ井乗務区 おみくじ結果は【${currentRes.rank}】！ ${currentRes.item} https://shinorail.github.io/shinonoi-2026/`;
    window.open(`https://social-plugins.line.me/lineit/share?text=${encodeURIComponent(text)}`, '_blank');
}
</script>

</body>
</html>
