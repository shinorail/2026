<!DOCTYPE html>
<html lang="ja">
<head>
    <link rel="icon" href="favicon.ico">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è¶…ãƒ»ã‚¹ãƒãƒ¼ã‚¯ - ç¯ ãƒäº•ä¹—å‹™åŒº</title>
    <style>
        :root { --main: #3f51b5; --bg: #f5f5f5; --accent: #ff9800; --text: #333; --panel: #ffffff; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; text-align: center; margin: 0; touch-action: none; overflow: hidden; }
        
        #ban-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; color: #ff0000; display: none; z-index: 100000; align-items: center; justify-content: center; flex-direction: column; font-weight: bold; }
        .repair-link { margin-top: 30px; padding: 15px; border: 1px solid #444; border-radius: 8px; background: #111; }
        .repair-link a { color: #ffd700; font-weight: bold; text-decoration: none; border-bottom: 1px solid #ffd700; }

        body.theme-neon { --main: #7b1fa2; --bg: #f3e5f5; --accent: #00bcd4; }
        body.theme-cyber { --main: #2e7d32; --bg: #e8f5e9; --accent: #fbc02d; }
        body.theme-classic { --main: #3f51b5; --bg: #f5f5f5; --accent: #ff9800; }

        .score-area { display: flex; justify-content: space-between; padding: 10px 20px; background: #fff; border-bottom: 3px solid var(--main); }
        .fps-counter { font-size: 0.8rem; color: #888; }

        #game-area { position: relative; width: 90vw; height: 90vw; max-width: 400px; max-height: 400px; margin: 10px auto; background: #fafafa; border: 4px solid var(--main); border-radius: 15px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        canvas { width: 100%; height: 100%; display: block; }

        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.98); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; padding: 15px; box-sizing: border-box; }
        .btn { width: 100%; padding: 12px; margin: 5px 0; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; text-decoration: none; display: block; box-sizing: border-box; font-size: 1rem; }
        .btn-diff { background: #eee; color: #444; text-align: center; border: 2px solid transparent; cursor: pointer; }
        .btn-diff.active { background: #fff; border-color: var(--main); color: var(--main); }

        .name-label { font-size: 0.9rem; font-weight: bold; margin-bottom: 5px; color: var(--main); }
        .list-container { width: 100%; height: 120px; overflow-y: auto; background: #fff; border: 2px solid #ddd; margin-bottom: 10px; border-radius: 8px; }
        .list-item { padding: 12px; font-size: 1.1rem; border-bottom: 1px solid #eee; color: #333; text-align: center; background: #fff; cursor: pointer; }
        .list-item.selected { background: var(--main) !important; color: #fff !important; font-weight: bold; }

        .pad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; width: 280px; margin: 5px auto; }
        .p-btn { height: 60px; background: #fff; border: 3px solid var(--main); border-radius: 15px; font-size: 1.8rem; display: flex; align-items: center; justify-content: center; color: var(--main); font-weight: bold; cursor: pointer; }
        .p-btn:active { background: var(--main); color: #fff; }

        .theme-btns { display: flex; gap: 8px; margin-bottom: 10px; width: 100%; }
        .theme-btns button { flex: 1; padding: 5px; font-size: 0.7rem; border-radius: 5px; border: 1px solid #ccc; background: #fff; cursor: pointer; }

        .btn:disabled { background: #ccc !important; color: #666 !important; cursor: not-allowed !important; box-shadow: none !important; }
    </style>
</head>
<body class="theme-classic">

<div id="ban-screen">
    <h1>âš ï¸ é‹è¡Œåœæ­¢ä¸­</h1>
    <p>ä¸æ­£ãªã‚¹ã‚³ã‚¢æ“ä½œãŒæ¤œçŸ¥ã•ã‚Œã¾ã—ãŸã€‚</p>
    <p>å®‰å…¨ãªé‹è¡Œã®ãŸã‚ã€å…¥åŒºã‚’åˆ¶é™ã—ã¦ã„ã¾ã™ã€‚</p>
    <p style="color:#333; font-size:0.7rem; margin-top:20px;">ERR_CODE: SC_CH_01</p>
    <div class="repair-link">
        <p style="font-size: 0.8rem; color: #aaa; margin: 0 0 10px 0;">æœ¬ç·šã¸ã®å¾©å¸°ã‚’å¸Œæœ›ã•ã‚Œã‚‹å ´åˆã¯</p>
        <a href="https://shinorail.github.io/2026/ban_contact.html">ğŸ› ï¸ è»Šä¸¡ä¿®ç¹•ãƒ»å¾©å¸°ç”³è«‹ã¯ã“ã¡ã‚‰</a>
    </div>
</div>

<div class="score-area">
    <div id="fps" class="fps-counter">FPS: 0</div>
    <div style="font-weight:bold;">ã‚¹ã‚³ã‚¢: <span id="now-score" style="font-size:1.5rem; color:var(--main);">0</span></div>
</div>

<div id="game-area">
    <canvas id="snakeGame" width="400" height="400"></canvas>
    
    <div id="start-screen" class="overlay">
        <div class="theme-btns">
            <button onclick="setTheme('classic')">æ¨™æº–</button>
            <button onclick="setTheme('neon')">ã‚€ã‚‰ã•ã</button>
            <button onclick="setTheme('cyber')">ã¿ã©ã‚Š</button>
        </div>
        <div class="name-label">ã€1ã€‘ãªã¾ãˆã‚’ãˆã‚‰ã‚“ã§ã­</div>
        <div class="list-container" id="name-selector"></div>
        <div class="name-label">ã€2ã€‘ã‚€ãšã‹ã—ã•ã‚’ãˆã‚‰ã¶</div>
        <div id="diff-container" style="width:100%; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 5px; margin-bottom: 10px;">
            <button class="btn-diff active" onclick="setDiff(0)" style="padding: 5px;">â˜†<br><span style="font-size:0.6rem;">ã‚„ã•ã—ã„</span></button>
            <button class="btn-diff" onclick="setDiff(2)" style="padding: 5px;">â˜†â˜†â˜†<br><span style="font-size:0.6rem;">ãµã¤ã†</span></button>
            <button class="btn-diff" onclick="setDiff(4)" style="padding: 5px;">â˜†â˜†â˜†â˜†â˜†<br><span style="font-size:0.6rem;">ãŸã¤ã˜ã‚“</span></button>
        </div>
        <button class="btn" style="background:var(--main); color:#fff; font-size:1.3rem; margin-top:5px;" onclick="initGame()">ã‚ãã¶ï¼</button>
        <a href="index.html" style="font-size:0.8rem; color:#888; margin-top:10px;">ãƒˆãƒƒãƒ—ã«ã‚‚ã©ã‚‹</a>
    </div>

    <div id="result-popup" class="overlay" style="display:none;">
        <div style="font-size:1.2rem; color:#666;">ã‚¹ã‚³ã‚¢</div>
        <div style="font-size:4rem; color:var(--main); font-weight: bold;" id="final-score">0</div>
        <div id="rank-display" style="margin:10px 0; font-weight:bold; color:var(--accent);"></div>
        <button class="btn" id="send-btn" onclick="sendScore()" style="background:var(--accent); color:#fff;">ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«ã®ã›ã‚‹</button>
        <a href="rank.html" class="btn" style="background:var(--main); color:#fff;">ãƒ™ã‚¹ãƒˆ10ã‚’ã¿ã‚‹</a>
        <button class="btn" style="background:#eee; color:#666;" onclick="location.reload()">ã‚‚ã†ã„ã¡ã©</button>
    </div>
</div>

<div class="pad">
    <div></div><div class="p-btn" onclick="setD('U')">â†‘</div><div></div>
    <div class="p-btn" onclick="setD('L')">â†</div><div class="p-btn" onclick="setD('D')">â†“</div><div class="p-btn" onclick="setD('R')">â†’</div>
</div>

<script>
const expiry = new Date("2026/02/01 00:00:00").getTime();
if (new Date().getTime() >= expiry) window.location.href = "memorial.html";

function applyBan() {
    localStorage.setItem('banned_user', 'true');
    sessionStorage.setItem('banned_session', 'true');
    document.getElementById('ban-screen').style.display = 'flex';
}

if (localStorage.getItem('banned_user') === 'true' || sessionStorage.getItem('banned_session') === 'true') {
    applyBan();
}

let tc = 0; let lt = 0;
window.addEventListener('click', () => {
    const n = Date.now();
    if (n - lt < 400) tc++; else tc = 1;
    lt = n;
    if (tc === 3) {
        const p = prompt("Auth Code");
        if (btoa(p) === "c2hpbm8ybmQ=") {
            localStorage.removeItem('banned_user');
            sessionStorage.removeItem('banned_session');
            location.reload();
        }
        tc = 0;
    }
});

const cvs = document.getElementById("snakeGame");
const ctx = cvs.getContext("2d");
const box = 20;
let snake, food, dir, gameInterval, score, isSending = false;
let selectedName = "", selectedDiff = 0, lastTime = 0, lastScoreUpdate = Date.now();

const diffSettings = [
    {speed: 250, label: "ã‚„ã•ã—ã„"},
    {speed: 180, label: "åˆç´š"},
    {speed: 120, label: "ãµã¤ã†"},
    {speed: 80, label: "ä¸Šç´š"},
    {speed: 40, label: "ãŸã¤ã˜ã‚“"}
];

const names = ["ã‚ã‹ã","ã‚ã•ã¾","ã‚ãšã•","ã—ãªã®","ã‹ãŒã‚„ã","ã¯ããŸã‹","ã“ã¾ã¡","ã¯ã‚„ã¶ã•","ã®ãã¿","ã¿ãšã»","ã¤ã°ã‚","ã‹ã„ã˜","ã²ãŸã¡","ã¨ã","ã„ãªã»"];
const nameBox = document.getElementById("name-selector");

function renderNames() {
    nameBox.innerHTML = "";
    names.forEach(n => {
        const div = document.createElement("div");
        div.className = "list-item";
        div.innerText = n;
        div.onclick = () => {
            document.querySelectorAll('.list-item').forEach(el => el.classList.remove('selected'));
            div.classList.add('selected');
            selectedName = n;
        };
        nameBox.appendChild(div);
    });
}
renderNames();

function setTheme(t) { document.body.className = "theme-" + t; }

function setDiff(idx) {
    selectedDiff = idx;
    const btns = document.querySelectorAll('.btn-diff');
    btns[0].classList.toggle('active', idx === 0);
    btns[1].classList.toggle('active', idx === 2);
    btns[2].classList.toggle('active', idx === 4);
}

function initGame() {
    if (!selectedName) { alert("ãªã¾ãˆã‚’ãˆã‚‰ã‚“ã§ã­ï¼"); return; }
    document.getElementById("start-screen").style.display = "none";
    score = 0;
    document.getElementById("now-score").innerText = score;
    snake = [{x: 10 * box, y: 10 * box}];
    food = { x: Math.floor(Math.random()*19)*box, y: Math.floor(Math.random()*19)*box };
    dir = "R";
    gameInterval = setInterval(gameLoop, diffSettings[selectedDiff].speed);
    requestAnimationFrame(updateFPS);
}

function updateFPS(t) {
    if (lastTime) { document.getElementById("fps").innerText = "FPS: " + Math.round(1000/(t-lastTime)); }
    lastTime = t;
    if (gameInterval) requestAnimationFrame(updateFPS);
}

function setD(d) {
    if(d=="L" && dir!="R") dir="L";
    if(d=="U" && dir!="D") dir="U";
    if(d=="R" && dir!="L") dir="R";
    if(d=="D" && dir!="U") dir="D";
}

function gameLoop() {
    ctx.fillStyle = "#fafafa"; ctx.fillRect(0,0,400,400);
    ctx.fillStyle = "#ff5252"; ctx.fillRect(food.x, food.y, box-1, box-1);
    const mainColor = getComputedStyle(document.body).getPropertyValue('--main');
    const accentColor = getComputedStyle(document.body).getPropertyValue('--accent');
    
    snake.forEach((s, i) => {
        ctx.fillStyle = (i==0) ? accentColor : mainColor;
        ctx.fillRect(s.x, s.y, box-1, box-1);
    });

    let hX = snake[0].x, hY = snake[0].y;
    if(dir=="L") hX -= box; if(dir=="U") hY -= box;
    if(dir=="R") hX += box; if(dir=="D") hY += box;

    if(hX == food.x && hY == food.y) {
        const now = Date.now();
        if (now - lastScoreUpdate < 50) applyBan();
        lastScoreUpdate = now;
        score += (selectedDiff + 1) * 10;
        document.getElementById("now-score").innerText = score;
        food = { x: Math.floor(Math.random()*19)*box, y: Math.floor(Math.random()*19)*box };
    } else { snake.pop(); }

    let nH = {x: hX, y: hY};
    if(hX<0 || hX>=400 || hY<0 || hY>=400 || snake.some(s => s.x==nH.x && s.y==nH.y)) {
        clearInterval(gameInterval); gameInterval = null;
        document.getElementById("result-popup").style.display = "flex";
        document.getElementById("final-score").innerText = score;
        return;
    }
    snake.unshift(nH);
}

function sendScore() {
    if(isSending) return;
    if (score <= 0) { alert("0ç‚¹ã§ã¯ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«ã®ã›ã‚‰ã‚Œã¾ã›ã‚“ï¼"); return; }
    
    // ã€ãƒãƒ¼ãƒˆæ¤œçŸ¥ã€‘ban_contact.htmlã¸èª˜å°
    if (score > 4000) { 
        alert("ç•°å¸¸ãªã‚¹ã‚³ã‚¢ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚");
        window.location.href = "https://shinorail.github.io/2026/ban_contact.html";
        return; 
    }

    // ã€ä¸å…·åˆãƒ»é€šå¸¸ç¢ºèªã€‘contact.htmlã¸èª˜å°
    const confirmMsg = "ã“ã®ã‚¹ã‚³ã‚¢ã§é‹è¡Œè¨˜éŒ²ã‚’é€ä¿¡ã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆé€ä¿¡ã§ããªã„å ´åˆã¯ã€Œã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€ã‚’æŠ¼ã—ã¦ä¸å…·åˆå ±å‘Šã¸ï¼‰";
    if (!confirm(confirmMsg)) {
        if (confirm("ç™»éŒ²ã‚’ã‚„ã‚ã¦ä¸å…·åˆå ±å‘Šï¼ˆãŠå•ã„åˆã‚ã›ï¼‰ã¸ç§»å‹•ã—ã¾ã™ã‹ï¼Ÿ")) {
            window.location.href = "https://shinorail.github.io/2026/contact.html";
        }
        return;
    }
    
    isSending = true;
    const sendBtn = document.getElementById("send-btn");
    sendBtn.disabled = true;
    sendBtn.innerText = "è¨˜éŒ²ã‚’é€ä¿¡ä¸­...";
    sendBtn.style.opacity = "0.7";

    const gasUrl = "https://script.google.com/macros/s/AKfycbw1Wmit3zAGi1sYBr-F_a8JnEjepmtZL9CJATnOxSdNp0Uz4UTuKu1kgFK6WmdWQ1US/exec";

    fetch(gasUrl, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: `nickname=${encodeURIComponent(selectedName)}&score=${score}&icon=${encodeURIComponent('ğŸ')}`
    })
    .then(() => {
        alert("é‹è¡Œè¨˜éŒ²ãŒç™»éŒ²ã•ã‚Œã¾ã—ãŸï¼");
        window.location.href = "rank.html";
    })
    .catch(error => {
        console.error("Error:", error);
        if (confirm("é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ä¸å…·åˆå ±å‘Šï¼ˆãŠå•ã„åˆã‚ã›ï¼‰ã¸ç§»å‹•ã—ã¾ã™ã‹ï¼Ÿ")) {
            window.location.href = "https://shinorail.github.io/2026/contact.html";
        } else {
            isSending = false;
            sendBtn.disabled = false;
            sendBtn.innerText = "ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«ã®ã›ã‚‹";
            sendBtn.style.opacity = "1";
        }
    });
}
</script>

<footer style="margin-top: 80px; padding: 30px 10px; border-top: 1px solid #ccc; text-align: center; background: #eee; color: #666;">
    <div style="font-size: 0.75rem; margin-bottom: 10px;">
        <a href="terms.html" style="color: #444; text-decoration: underline; margin: 0 10px;">åˆ©ç”¨è¦ç´„ãƒ»æ¨©åˆ©è¦å®š</a>
        <span style="margin: 0 5px;">|</span>
        <a href="https://shinorail.github.io/2026/ban_contact.html" style="color: #444; text-decoration: underline; margin: 0 10px;">è»Šä¸¡ä¿®ç¹•ç”³è«‹</a>
    </div>
    <p style="font-size: 0.8rem; font-weight: bold; margin: 5px 0;">&copy; 2023-2026 ç¯ ãƒäº•ä¹—å‹™åŒº</p>
    <p style="font-size: 0.6rem; line-height: 1.4; max-width: 500px; margin: auto;">
        æœ¬ã‚µã‚¤ãƒˆã¯å€‹äººé‹å–¶ã®ãƒ•ã‚¡ãƒ³ã‚µã‚¤ãƒˆã§ã‚ã‚Šã€å®Ÿéš›ã®é‰„é“äº‹æ¥­è€…ç­‰ã¨ã¯ç„¡é–¢ä¿‚ã§ã™ã€‚
    </p>
</footer>

<script>
(function() {
    const expiry = new Date("2026-02-01T00:00:00+09:00").getTime();
    if (new Date().getTime() >= expiry) {
        window.location.href = "memorial.html";
    }
})();
</script>
</body>
</html>
