<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>キッズページ - 篠ノ井乗務区</title>
<style>
:root { --main: #ff9800; --bg: #fff9e6; }
body { background: var(--bg); font-family: sans-serif; text-align: center; margin: 0; padding: 20px; touch-action: manipulation; }
h1 { font-size: 2.5rem; color: var(--main); margin: 10px 0; }

/* 巨大ボタン */
.btn { 
    display: block; width: 90%; margin: 15px auto; padding: 25px 0; 
    background: var(--main); color: #fff; text-decoration: none; 
    border-radius: 50px; font-size: 1.8rem; font-weight: bold; 
    border: 6px solid #fff; box-shadow: 0 6px 0 #e68a00; cursor: pointer;
}
.btn:disabled { background: #ccc; box-shadow: 0 6px 0 #999; cursor: not-allowed; }

/* ゲーム画面 */
#game-box { position: relative; display: inline-block; background: #000; padding: 10px; border: 10px solid var(--main); border-radius: 20px; }
canvas { background: #000; display: block; max-width: 100%; height: auto; }

/* 操作ボタン */
.pad { display: grid; grid-template-columns: repeat(3, 70px); grid-template-rows: repeat(2, 70px); gap: 10px; justify-content: center; margin: 20px 0; }
.p-btn { width: 70px; height: 70px; background: #fff; border: 3px solid var(--main); border-radius: 15px; font-size: 2rem; display: flex; align-items: center; justify-content: center; font-weight: bold; color: var(--main); }
.p-btn:active { background: var(--main); color: #fff; }

.over-msg { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #fff; font-size: 2rem; font-weight: bold; background: rgba(0,0,0,0.8); width: 100%; padding: 20px 0; display: none; }

footer { margin-top: 50px; border-top: 1px solid #ccc; padding-top: 20px; font-weight: bold; }
</style>
</head>
<body>

<h1>キッズページ</h1>

<button id="k-rail" class="btn" onclick="location.href='rail_result.html'" disabled>てつどう おみくじ</button>
<button id="k-norm" class="btn" onclick="location.href='norm_result.html'" disabled style="background:#f44336; box-shadow:0 6px 0 #d32f2f;">ふつうの おみくじ</button>

<div id="game-box">
    <canvas id="snakeGame" width="300" height="300"></canvas>
    <div id="over" class="over-msg">ざんねん！</div>
</div>

<div id="ui">
    <button id="start-btn" class="btn" style="background:#4caf50; box-shadow:0 6px 0 #388e3c;" onclick="startGame()">あそぶ！(スタート)</button>
    <button id="retry-btn" class="btn" style="background:#2196f3; box-shadow:0 6px 0 #1976d2; display:none;" onclick="startGame()">もういっかい！</button>
</div>

<div class="pad">
    <div style="grid-column:2" class="p-btn" onclick="setD('U')">↑</div>
    <div style="grid-column:1; grid-row:2" class="p-btn" onclick="setD('L')">←</div>
    <div style="grid-column:2; grid-row:2" class="p-btn" onclick="setD('D')">↓</div>
    <div style="grid-column:3; grid-row:2" class="p-btn" onclick="setD('R')">→</div>
</div>

<a href="index.html" class="btn" style="background:#666; box-shadow:0 6px 0 #444; font-size:1.2rem;">← もどる</a>

<footer>
    製造元：GitHub / 制作・著作：篠ノ井乗務区
</footer>

<script>
const cvs = document.getElementById("snakeGame");
const ctx = cvs.getContext("2d");
const box = 15;
let snake, food, dir, gameInterval;

function startGame() {
    snake = [{x: 10 * box, y: 10 * box}];
    food = { x: Math.floor(Math.random()*19)*box, y: Math.floor(Math.random()*19)*box };
    dir = "R";
    document.getElementById("over").style.display = "none";
    document.getElementById("start-btn").style.display = "none";
    document.getElementById("retry-btn").style.display = "none";
    if(gameInterval) clearInterval(gameInterval);
    gameInterval = setInterval(draw, 120);
}

function setD(d) {
    if(d=="L" && dir!="R") dir="L";
    if(d=="U" && dir!="D") dir="U";
    if(d=="R" && dir!="L") dir="R";
    if(d=="D" && dir!="U") dir="D";
}

document.addEventListener("keydown", e => {
    if(e.keyCode==37) setD("L"); if(e.keyCode==38) setD("U");
    if(e.keyCode==39) setD("R"); if(e.keyCode==40) setD("D");
});

function draw() {
    ctx.fillStyle = "black"; ctx.fillRect(0,0,300,300);
    for(let i=0; i<snake.length; i++) {
        ctx.fillStyle = (i==0) ? "#ff9800" : "#ffcc80";
        ctx.fillRect(snake[i].x, snake[i].y, box, box);
    }
    ctx.fillStyle = "red"; ctx.fillRect(food.x, food.y, box, box);

    let hX = snake[0].x; let hY = snake[0].y;
    if(dir=="L") hX -= box; if(dir=="U") hY -= box;
    if(dir=="R") hX += box; if(dir=="D") hY += box;

    if(hX == food.x && hY == food.y) {
        food = { x: Math.floor(Math.random()*19)*box, y: Math.floor(Math.random()*19)*box };
    } else { snake.pop(); }

    let nH = {x: hX, y: hY};
    if(hX<0 || hX>=300 || hY<0 || hY>=300 || snake.some(s => s.x==nH.x && s.y==nH.y)) {
        clearInterval(gameInterval);
        document.getElementById("over").style.display = "block";
        document.getElementById("retry-btn").style.display = "block";
        return;
    }
    snake.unshift(nH);
}

// おみくじ公開
const start = new Date("2026/01/01 00:00:00");
function update() {
    const ready = new Date() >= start;
    document.getElementById('k-rail').disabled = !ready;
    document.getElementById('k-norm').disabled = !ready;
}
setInterval(update, 1000); update();
setTimeout(() => location.reload(), 300000);
</script>
</body>
</html>
