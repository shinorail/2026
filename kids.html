<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Googleã‚¹ã‚¿ã‚¤ãƒ«ãƒ»ã‚¹ãƒãƒ¼ã‚¯ - ç¯ ãƒäº•ä¹—å‹™åŒº</title>
    <style>
        :root {
            --grass-light: #aad751;
            --grass-dark: #a2d149;
            --snake-head: #4e7cf6;
            --snake-body: #5285f4;
            --apple: #e91e63;
            --obs: #573111;
        }
        body { background: #4a752c; color: #fff; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; text-align: center; margin: 0; overflow: hidden; }
        
        /* ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¨ãƒªã‚¢ */
        .header { background: #4a752c; display: flex; justify-content: center; align-items: center; gap: 40px; padding: 10px; font-weight: bold; font-size: 1.2rem; }
        .info-item { display: flex; align-items: center; gap: 8px; }
        
        /* ã‚²ãƒ¼ãƒ ãƒœãƒ¼ãƒ‰ */
        #game-container { position: relative; width: 400px; height: 400px; margin: 0 auto; border-radius: 8px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        canvas { display: block; background: var(--grass-light); }

        /* ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼ˆè¨­å®šãƒ»çµæœï¼‰ */
        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; }
        .menu-card { background: #fff; color: #333; padding: 20px; border-radius: 12px; width: 85%; max-width: 320px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        h2 { margin: 0 0 15px; color: #4a752c; font-size: 1.4rem; }

        /* è¨­å®šãƒœã‚¿ãƒ³ç¾¤ */
        .option-group { margin-bottom: 15px; text-align: left; }
        .option-label { font-size: 0.8rem; font-weight: bold; color: #666; margin-bottom: 5px; }
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .toggle-btn { background: #eee; border: 2px solid #ddd; padding: 8px; border-radius: 6px; cursor: pointer; font-size: 0.8rem; font-weight: bold; }
        .toggle-btn.active { background: #4a752c; color: #fff; border-color: #4a752c; }

        /* æ“ä½œãƒ‘ãƒãƒ« */
        .controls { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; width: 210px; margin: 20px auto; }
        .dir-btn { height: 60px; background: rgba(255,255,255,0.2); border: 2px solid #fff; border-radius: 50%; color: #fff; font-size: 1.5rem; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .dir-btn:active { background: #fff; color: #4a752c; }

        /* ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç°¡æ˜“è¡¨ç¤º */
        #rank-list { font-size: 0.8rem; text-align: left; margin: 10px 0; background: #f9f9f9; padding: 8px; border-radius: 5px; }
        
        .play-btn { background: #4a752c; color: #fff; border: none; padding: 12px 30px; border-radius: 25px; font-weight: bold; font-size: 1.1rem; cursor: pointer; width: 100%; margin-top: 10px; }
    </style>
</head>
<body>

<div class="header">
    <div class="info-item">ğŸ <span id="score">0</span></div>
    <div class="info-item">ğŸ† <span id="best">0</span></div>
    <div class="info-item">ğŸš© STAGE <span id="stage">1</span></div>
</div>

<div id="game-container">
    <canvas id="gameCanvas" width="400" height="400"></canvas>

    <div id="start-menu" class="overlay">
        <div class="menu-card">
            <h2>CUSTOMIZE</h2>
            
            <div class="option-group">
                <div class="option-label">ãƒ¢ãƒ¼ãƒ‰</div>
                <div class="btn-grid">
                    <button id="mode-normal" class="toggle-btn active" onclick="setMode('normal')">æ¨™æº–</button>
                    <button id="mode-obs" class="toggle-btn" onclick="setMode('obs')">éšœå®³ç‰©</button>
                </div>
            </div>

            <div class="option-group">
                <div class="option-label">ã¯ã‚„ã•</div>
                <div class="btn-grid">
                    <button id="speed-1" class="toggle-btn active" onclick="setSpd(150, 1)">ãµã¤ã†</button>
                    <button id="speed-2" class="toggle-btn" onclick="setSpd(80, 2)">ã¯ã‚„ã„</button>
                </div>
            </div>

            <button class="play-btn" onclick="startGame()">START</button>
        </div>
    </div>

    <div id="result-menu" class="overlay" style="display:none;">
        <div class="menu-card">
            <h2 id="result-title">GAME OVER</h2>
            <div id="rank-list"></div>
            <button class="play-btn" onclick="location.reload()">RETRY</button>
        </div>
    </div>
</div>

<div class="controls">
    <div></div><div class="dir-btn" onclick="handleInput('UP')">â†‘</div><div></div>
    <div class="dir-btn" onclick="handleInput('LEFT')">â†</div><div class="dir-btn" onclick="handleInput('DOWN')">â†“</div><div class="dir-btn" onclick="handleInput('RIGHT')">â†’</div>
</div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const grid = 20;
    
    let snake, apple, obstacles, direction, nextDirection, score, stage, gameLoop, isGameOver;
    let config = { mode: 'normal', speed: 150 };

    // æœ€é«˜ã‚¹ã‚³ã‚¢èª­ã¿è¾¼ã¿
    document.getElementById("best").innerText = localStorage.getItem("snake_best") || 0;

    function setMode(m) {
        config.mode = m;
        document.getElementById('mode-normal').classList.toggle('active', m === 'normal');
        document.getElementById('mode-obs').classList.toggle('active', m === 'obs');
    }

    function setSpd(s, id) {
        config.speed = s;
        document.getElementById('speed-1').classList.toggle('active', id === 1);
        document.getElementById('speed-2').classList.toggle('active', id === 2);
    }

    function startGame() {
        document.getElementById("start-menu").style.display = "none";
        resetGame();
        loop();
    }

    function resetGame() {
        snake = [{x: 160, y: 160}, {x: 140, y: 160}, {x: 120, y: 160}];
        apple = {x: 240, y: 160};
        obstacles = [];
        direction = 'RIGHT';
        nextDirection = 'RIGHT';
        score = 0;
        stage = 1;
        isGameOver = false;
        updateUI();
    }

    function updateUI() {
        document.getElementById("score").innerText = score;
        document.getElementById("stage").innerText = stage;
    }

    function spawnApple() {
        apple = {
            x: Math.floor(Math.random() * 20) * grid,
            y: Math.floor(Math.random() * 20) * grid
        };
        // é‡ãªã‚Šãƒã‚§ãƒƒã‚¯
        if (snake.some(s => s.x === apple.x && s.y === apple.y) || 
            obstacles.some(o => o.x === apple.x && o.y === apple.y)) spawnApple();
    }

    function spawnObstacles() {
        obstacles = [];
        if (config.mode === 'obs') {
            for (let i = 0; i < stage; i++) {
                obstacles.push({
                    x: Math.floor(Math.random() * 20) * grid,
                    y: Math.floor(Math.random() * 20) * grid
                });
            }
        }
    }

    function handleInput(key) {
        if (key === 'UP' && direction !== 'DOWN') nextDirection = 'UP';
        if (key === 'DOWN' && direction !== 'UP') nextDirection = 'DOWN';
        if (key === 'LEFT' && direction !== 'RIGHT') nextDirection = 'LEFT';
        if (key === 'RIGHT' && direction !== 'LEFT') nextDirection = 'RIGHT';
    }

    // PCã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œ
    window.addEventListener("keydown", e => {
        if (e.key === "ArrowUp") handleInput('UP');
        if (e.key === "ArrowDown") handleInput('DOWN');
        if (e.key === "ArrowLeft") handleInput('LEFT');
        if (e.key === "ArrowRight") handleInput('RIGHT');
    });

    function loop() {
        if (isGameOver) return;
        
        direction = nextDirection;
        let head = { ...snake[0] };

        if (direction === 'UP') head.y -= grid;
        if (direction === 'DOWN') head.y += grid;
        if (direction === 'LEFT') head.x -= grid;
        if (direction === 'RIGHT') head.x += grid;

        // å£ãƒ»è‡ªåˆ†ãƒ»éšœå®³ç‰©ã¸ã®è¡çªåˆ¤å®š
        if (head.x < 0 || head.x >= 400 || head.y < 0 || head.y >= 400 || 
            snake.some(s => s.x === head.x && s.y === head.y) ||
            obstacles.some(o => o.x === head.x && o.y === head.y)) {
            endGame();
            return;
        }

        snake.unshift(head);

        // ãƒªãƒ³ã‚´ã‚’é£Ÿã¹ãŸã‹
        if (head.x === apple.x && head.y === apple.y) {
            score += 10;
            if (score % 50 === 0 && stage < 100) {
                stage++;
                if (config.mode === 'obs') spawnObstacles();
            }
            updateUI();
            spawnApple();
        } else {
            snake.pop();
        }

        draw();
        setTimeout(loop, Math.max(30, config.speed - (stage * 2)));
    }

    function draw() {
        // èƒŒæ™¯ï¼ˆå¸‚æ¾æ¨¡æ§˜ï¼‰
        for (let i = 0; i < 20; i++) {
            for (let j = 0; j < 20; j++) {
                ctx.fillStyle = (i + j) % 2 === 0 ? "#aad751" : "#a2d149";
                ctx.fillRect(i * grid, j * grid, grid, grid);
            }
        }

        // éšœå®³ç‰©
        ctx.fillStyle = "#573111";
        obstacles.forEach(o => {
            ctx.beginPath();
            ctx.roundRect(o.x+2, o.y+2, grid-4, grid-4, 4);
            ctx.fill();
        });

        // ãƒªãƒ³ã‚´
        ctx.fillStyle = "#e91e63";
        ctx.beginPath();
        ctx.arc(apple.x + grid/2, apple.y + grid/2, grid/2 - 2, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = "#fff"; // å…‰æ²¢
        ctx.beginPath();
        ctx.arc(apple.x + grid/3, apple.y + grid/3, 2, 0, Math.PI * 2);
        ctx.fill();

        // ãƒ˜ãƒ“
        snake.forEach((part, i) => {
            ctx.fillStyle = i === 0 ? "#4e7cf6" : "#5285f4";
            ctx.beginPath();
            ctx.roundRect(part.x, part.y, grid-1, grid-1, i === 0 ? 6 : 2);
            ctx.fill();
            
            // ç›®
            if (i === 0) {
                ctx.fillStyle = "#fff";
                ctx.fillRect(part.x + 4, part.y + 4, 4, 4);
                ctx.fillRect(part.x + 12, part.y + 4, 4, 4);
            }
        });
    }

    function endGame() {
        isGameOver = true;
        const best = localStorage.getItem("snake_best") || 0;
        if (score > best) localStorage.setItem("snake_best", score);
        
        // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ä¿å­˜
        let ranks = JSON.parse(localStorage.getItem("snake_ranks") || "[]");
        ranks.push({score, stage, date: new Date().toLocaleDateString()});
        ranks.sort((a,b) => b.score - a.score);
        ranks = ranks.slice(0, 5);
        localStorage.setItem("snake_ranks", JSON.stringify(ranks));

        const listHtml = ranks.map((r, i) => `<div>${i+1}ä½: ${r.score}ç‚¹ (ST.${r.stage})</div>`).join('');
        document.getElementById("rank-list").innerHTML = listHtml;
        document.getElementById("result-menu").style.display = "flex";
    }
</script>
</body>
</html>
