<!DOCTYPE html>
<html lang="ja">
<head>
    <link rel="icon" href="favicon.ico">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è¶…ãƒ»ã‚¹ãƒãƒ¼ã‚¯ - ç¯ ãƒäº•ä¹—å‹™åŒº</title>
    <style>
        :root { --main: #3f51b5; --bg: #f5f5f5; --accent: #ff9800; --text: #333; --panel: #ffffff; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; text-align: center; margin: 0; touch-action: none; overflow-x: hidden; padding-bottom: 160px; }
        
        #ban-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; color: #ff0000; display: none; z-index: 100000; align-items: center; justify-content: center; flex-direction: column; font-weight: bold; }
        .repair-link { margin-top: 30px; padding: 15px; border: 1px solid #444; border-radius: 8px; background: #111; }
        .repair-link a { color: #ffd700; font-weight: bold; text-decoration: none; border-bottom: 1px solid #ffd700; }

        .score-area { display: flex; justify-content: space-between; padding: 10px 20px; background: #fff; border-bottom: 3px solid var(--main); }
        .fps-counter { font-size: 0.8rem; color: #888; }

        #game-area { position: relative; width: 90vw; height: 90vw; max-width: 400px; max-height: 400px; margin: 10px auto; background: #fafafa; border: 4px solid var(--main); border-radius: 15px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        canvas { width: 100%; height: 100%; display: block; }

        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.98); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; padding: 15px; box-sizing: border-box; }
        .btn { width: 100%; padding: 12px; margin: 5px 0; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; text-decoration: none; display: block; box-sizing: border-box; font-size: 1rem; }

        /* ãŠã¿ãã˜æ¼”å‡ºç”¨ */
        #kuji-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 20000; display: none; align-items: center; justify-content: center; }
        #kuji-card { background: #fff; border: 6px solid #000; padding: 25px; width: 240px; text-align: center; box-shadow: 15px 15px 0px #f00; animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        @keyframes pop { 0% { transform: scale(0); } 100% { transform: scale(1); } }

        /* ä¸‹éƒ¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ */
        .msg-window { position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%); width: 92%; max-width: 600px; background: #000; border: 3px solid #fff; padding: 12px; z-index: 10000; display: flex; flex-direction: column; box-shadow: 0 0 0 4px #000; }
        .msg-text { color: #fff; font-size: 0.8rem; text-align: left; margin-bottom: 10px; min-height: 2.5em; }
        .btn-row { display: flex; gap: 8px; justify-content: flex-end; }
        .mini-btn { background: #ff4500; color: #fff; border: 2px solid #fff; padding: 8px 12px; cursor: pointer; font-size: 0.7rem; font-weight: bold; }

        .pad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; width: 280px; margin: 5px auto; }
        .p-btn { height: 60px; background: #fff; border: 3px solid var(--main); border-radius: 15px; font-size: 1.8rem; display: flex; align-items: center; justify-content: center; color: var(--main); font-weight: bold; cursor: pointer; }

        .ver-tag { position: fixed; bottom: 140px; right: 10px; background: #000; color: #0f0; padding: 2px 6px; font-size: 9px; z-index: 9999; }
    </style>
</head>
<body class="theme-classic">

<div id="ban-screen">
    <h1>âš ï¸ é‹è¡Œåœæ­¢ä¸­</h1>
    <p>ä¸æ­£ãªã‚¹ã‚³ã‚¢æ“ä½œãŒæ¤œçŸ¥ã•ã‚Œã¾ã—ãŸã€‚</p>
    <div class="repair-link">
        <a href="https://shinorail.github.io/2026/ban_contact.html">ğŸ› ï¸ è»Šä¸¡ä¿®ç¹•ãƒ»å¾©å¸°ç”³è«‹ã¯ã“ã¡ã‚‰</a>
    </div>
</div>

<div class="ver-tag">VER. 06.07</div>

<div id="kuji-overlay" onclick="closeKuji()">
    <div id="kuji-card">
        <div id="kuji-load">ãƒ’ã‚¤ãƒ†ãƒã‚¹...</div>
        <div id="kuji-res-area" style="display:none;">
            <div style="font-size:0.7rem; color:#888;">ç¯ ãƒäº•ãŠã¿ãã˜</div>
            <h2 id="luck-txt" style="color:#f00; font-size:3rem; margin:15px 0;"></h2>
            <div style="font-size:0.6rem; background:#eee; padding:5px;">[ é–‰ã˜ã¦ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç™»éŒ² ]</div>
        </div>
    </div>
</div>

<div class="score-area">
    <div id="fps" class="fps-counter">FPS: 0</div>
    <div style="font-weight:bold;">ã‚¹ã‚³ã‚¢: <span id="now-score" style="font-size:1.5rem; color:var(--main);">0</span></div>
</div>

<div id="game-area">
    <canvas id="snakeGame" width="400" height="400"></canvas>
    
    <div id="start-screen" class="overlay">
        <div class="name-label">ãªã¾ãˆã‚’ãˆã‚‰ã‚“ã§ã­</div>
        <div class="list-container" id="name-selector" style="width:100%; height:120px; overflow-y:auto; border:2px solid #ddd; margin-bottom:10px;"></div>
        <button class="btn" style="background:var(--main); color:#fff;" onclick="initGame()">ã‚ãã¶ï¼</button>
    </div>

    <div id="result-popup" class="overlay" style="display:none;">
        <div style="font-size:4rem; color:var(--main); font-weight: bold;" id="final-score">0</div>
        <button class="btn" id="send-btn" onclick="sendScore()" style="background:var(--accent); color:#fff;">ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«ã®ã›ã‚‹</button>
        <button class="btn" style="background:#eee; color:#666;" onclick="location.reload()">ã‚‚ã†ã„ã¡ã©</button>
    </div>
</div>

<div class="pad">
    <div></div><div class="p-btn" onclick="setD('U')">â†‘</div><div></div>
    <div class="p-btn" onclick="setD('L')">â†</div><div class="p-btn" onclick="setD('D')">â†“</div><div class="p-btn" onclick="setD('R')">â†’</div>
</div>

<div class="msg-window">
    <div class="msg-text" id="talk-box">ã€Œ2025å¹´ã‚‚ã‚ã¨ã‚ãšã‹ã€‚12/31ã¾ã§ãŠã¿ãã˜ãŒå¼•ã‘ã‚‹ã‚ˆã†ã§ã™ã€‚ã€</div>
    <div class="btn-row">
        <button id="kuji-main-btn" class="mini-btn" onclick="runKuji()">ãŠã¿ãã˜ã‚’å¼•ã</button>
        <button id="rank-reg-btn" class="mini-btn" style="background:#0066cc; display:none;" onclick="regKujiRank()">çµæœã‚’ç™»éŒ²</button>
    </div>
</div>

<script>
// ãŠã¿ãã˜å¤‰æ•°
let myLuck = "";

// ã‚²ãƒ¼ãƒ å¤‰æ•°
const cvs = document.getElementById("snakeGame");
const ctx = cvs.getContext("2d");
const box = 20;
let snake, food, dir, gameInterval, score;
let selectedName = "";

const names = ["ã‚ã‹ã","ã‚ã•ã¾","ã‚ãšã•","ã—ãªã®","ã‹ãŒã‚„ã","ã¯ããŸã‹","ã“ã¾ã¡","ã¯ã‚„ã¶ã•","ã®ãã¿","ã¿ãšã»","ã¤ã°ã‚","ã‹ã„ã˜","ã²ãŸã¡","ã¨ã","ã„ãªã»"];
const nameBox = document.getElementById("name-selector");

names.forEach(n => {
    const div = document.createElement("div");
    div.style.padding = "10px";
    div.innerText = n;
    div.onclick = () => {
        Array.from(nameBox.children).forEach(c => c.style.background = "#fff");
        div.style.background = "#3f51b5";
        div.style.color = "#fff";
        selectedName = n;
    };
    nameBox.appendChild(div);
});

function initGame() {
    if (!selectedName) { alert("ãªã¾ãˆã‚’ãˆã‚‰ã‚“ã§ã­ï¼"); return; }
    document.getElementById("start-screen").style.display = "none";
    score = 0;
    snake = [{x: 10 * box, y: 10 * box}];
    food = { x: Math.floor(Math.random()*19)*box, y: Math.floor(Math.random()*19)*box };
    dir = "R";
    gameInterval = setInterval(gameLoop, 120);
}

function setD(d) {
    if(d=="L" && dir!="R") dir="L";
    if(d=="U" && dir!="D") dir="U";
    if(d=="R" && dir!="L") dir="R";
    if(d=="D" && dir!="U") dir="D";
}

function gameLoop() {
    ctx.fillStyle = "#fafafa"; ctx.fillRect(0,0,400,400);
    ctx.fillStyle = "#ff5252"; ctx.fillRect(food.x, food.y, box-1, box-1);
    
    snake.forEach((s, i) => {
        ctx.fillStyle = (i==0) ? "#ff9800" : "#3f51b5";
        ctx.fillRect(s.x, s.y, box-1, box-1);
    });

    let hX = snake[0].x, hY = snake[0].y;
    if(dir=="L") hX -= box; if(dir=="U") hY -= box;
    if(dir=="R") hX += box; if(dir=="D") hY += box;

    if(hX == food.x && hY == food.y) {
        score += 10;
        document.getElementById("now-score").innerText = score;
        food = { x: Math.floor(Math.random()*19)*box, y: Math.floor(Math.random()*19)*box };
    } else { snake.pop(); }

    let nH = {x: hX, y: hY};
    if(hX<0 || hX>=400 || hY<0 || hY>=400 || snake.some(s => s.x==nH.x && s.y==nH.y)) {
        clearInterval(gameInterval);
        document.getElementById("result-popup").style.display = "flex";
        document.getElementById("final-score").innerText = score;
        return;
    }
    snake.unshift(nH);
}

// ãŠã¿ãã˜å‡¦ç†
function runKuji() {
    if (new Date() > new Date('2025/12/31 23:59:59')) {
        alert("ãŠã¿ãã˜æœŸé–“ã¯çµ‚äº†ã—ã¾ã—ãŸã€‚"); return;
    }
    const ov = document.getElementById('kuji-overlay');
    ov.style.display = 'flex';
    document.getElementById('kuji-load').style.display = 'block';
    document.getElementById('kuji-res-area').style.display = 'none';

    setTimeout(() => {
        document.getElementById('kuji-load').style.display = 'none';
        const res = ["å¤§å‰", "ä¸­å‰", "å°å‰", "å‰", "æœ«å‰"];
        myLuck = res[Math.floor(Math.random() * res.length)];
        document.getElementById('luck-txt').innerText = myLuck;
        document.getElementById('kuji-res-area').style.display = 'block';
    }, 1200);
}

function closeKuji() {
    document.getElementById('kuji-overlay').style.display = 'none';
    document.getElementById('rank-reg-btn').style.display = 'block';
    document.getElementById('talk-box').innerText = "ã€ŒãŠã¿ãã˜çµæœã‚’ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«è¨˜éŒ²ã§ãã¾ã™ã€‚ã€";
}

function regKujiRank() {
    if (!selectedName) { alert("ã‚²ãƒ¼ãƒ ã®ã€ãªã¾ãˆã€ã‚’å…ˆã«é¸ã‚“ã§ãã ã•ã„ã€‚"); return; }
    alert(`${selectedName}ã•ã‚“ã‚’ã€Œ${myLuck}ã€ã§ç™»éŒ²ã—ã¾ã—ãŸï¼`);
    document.getElementById('rank-reg-btn').style.display = 'none';
    document.getElementById('talk-box').innerText = "ã€Œç™»éŒ²å®Œäº†ã€‚è‰¯ã„å¹´ã«ãªã‚Šã¾ã™ã‚ˆã†ã«ï¼ã€";
}

function sendScore() {
    alert("é‹è¡Œè¨˜éŒ²ã‚’é€ä¿¡ã—ã¾ã—ãŸï¼");
    window.location.href = "ranking.html";
}
</script>
</body>
</html>
