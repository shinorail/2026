<!DOCTYPE html>
<html lang="ja">
<head>
    <link rel="icon" href="favicon.ico">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>鉄道おみくじ結果 - 篠ノ井乗務区</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
:root { --red: #d32f2f; --bg: #fcfaf2; --gold: #d4af37; --blue: #1da1f2; --green: #24b500; }
body { background: var(--bg); font-family: "BIZ UDPGothic", sans-serif; text-align: center; margin: 0; padding: 20px; -webkit-text-size-adjust: 100%; }

#screenshot-target { background: #fff; border: 3px solid var(--red); border-radius: 20px; padding: 30px 20px; max-width: 450px; margin: 20px auto; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
.unsei { font-size: 1.1rem; color: #666; margin-bottom: 5px; }
.rank { font-size: 3.8rem; font-weight: bold; color: var(--red); margin: 0; letter-spacing: 2px; }
.train-name { font-size: 1.4rem; font-weight: bold; color: #333; margin: 20px 0; padding: 12px; border-top: 2px dashed #eee; border-bottom: 2px dashed #eee; background: #fffcf0; }
.message { font-size: 0.95rem; line-height: 1.7; color: #444; text-align: left; padding: 0 10px; min-height: 80px; }
.site-url { font-size: 0.7rem; color: #ccc; margin-top: 15px; display: block; }

.btn-container { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; max-width: 450px; margin: 20px auto; }
.btn { display: flex; align-items: center; justify-content: center; padding: 15px 5px; color: #fff; text-decoration: none; border-radius: 12px; font-weight: bold; font-size: 0.9rem; border: none; cursor: pointer; transition: 0.2s; }
.btn:active { transform: scale(0.95); }

.btn-save { background: var(--gold); grid-column: span 2; font-size: 1.1rem; }
.btn-tw { background: #000; }
.btn-line { background: var(--green); }
.btn-retry { background: var(--red); grid-column: span 2; margin-top: 10px; }

footer { margin-top: 40px; font-size: 0.7rem; color: #999; }
</style>
</head>
<body>

<div id="screenshot-target">
    <div class="unsei">2026年 本日の鉄道運勢</div>
    <p id="rank-display" class="rank">...</p>
    <div id="train-display" class="train-name">...</div>
    <div id="msg-display" class="message"></div>
    <span class="site-url">篠ノ井乗務区 2周年特設サイト<br>https://shinorail.github.io/shinonoi-2026/</span>
</div>

<div class="btn-container">
    <button class="btn btn-save" onclick="saveImage()">画像を保存してシェア</button>
    <button class="btn btn-tw" onclick="shareX()">Xでシェア</button>
    <button class="btn btn-line" onclick="shareLine()">LINEで送る</button>
    <a href="index.html" class="btn btn-retry">トップへ戻る</a>
</div>

<footer>
    製造元：GitHub / 制作・著作：篠ノ井乗務区
</footer>

<script>
const results = [
    { rank: "特大吉", train: "383系 特急しなの", msg: "最高の出発進行！振り子のように軽快に、どんな困難なカーブも鮮やかに乗り越えていける輝かしい一年になるでしょう。" },
    { rank: "大吉", train: "E353系 特急あずさ", msg: "スピード感あふれる一年！目標に向かって全速前進。快適な旅のような素晴らしい日々があなたを待っています。" },
    { rank: "中吉", train: "E127系 篠ノ井線", msg: "地域に愛される存在に。一歩ずつ着実に進むことで、大きな成果が得られる堅実で温かい運勢です。" },
    { rank: "吉", train: "211系 長野色", msg: "安定感抜群！信州のベテランのような落ち着きを持って過ごせば、周囲からの信頼もより一層高まります。" },
    { rank: "小吉", train: "HB-E300系 リゾートビューふるさと", msg: "景色を楽しみながらゆっくりと。焦らず自分のペースを大切にすることで、新しい発見があるでしょう。" },
    { rank: "末吉", train: "DE10形 ディーゼル機関車", msg: "縁の下の力持ち。目立たない場所での努力が、後できっと大きな力になって返ってきます。" }
];

// 1日1回制限
const today = new Date().toLocaleDateString();
const lastDate = localStorage.getItem('last_draw_rail');
let currentRes;

if (lastDate === today) {
    currentRes = JSON.parse(localStorage.getItem('saved_res_rail'));
    alert("おみくじは1日1回までです。本日の結果を表示します。");
} else {
    currentRes = results[Math.floor(Math.random() * results.length)];
    localStorage.setItem('last_draw_rail', today);
    localStorage.setItem('saved_res_rail', JSON.stringify(currentRes));
}

document.getElementById('rank-display').innerText = currentRes.rank;
document.getElementById('train-display').innerText = currentRes.train;
document.getElementById('msg-display').innerText = currentRes.msg;

function saveImage() {
    const target = document.getElementById("screenshot-target");
    html2canvas(target, { backgroundColor: "#fcfaf2", scale: 2 }).then(canvas => {
        const link = document.createElement("a");
        link.href = canvas.toDataURL("image/png");
        link.download = `shinorail_railkuji_${currentRes.rank}.png`;
        link.click();
        alert("画像を保存しました！");
    });
}

function shareX() {
    const text = `篠ノ井乗務区 鉄道おみくじ結果は【${currentRes.rank}】！\nラッキー車両：${currentRes.train}\n#篠ノ井乗務区 #鉄道おみくじ\n`;
    const url = "https://shinorail.github.io/shinonoi-2026/";
    window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`, '_blank');
}

function shareLine() {
    const text = `篠ノ井乗務区 鉄道おみくじ結果は【${currentRes.rank}】！ 車両：${currentRes.train} https://shinorail.github.io/shinonoi-2026/`;
    window.open(`https://social-plugins.line.me/lineit/share?text=${encodeURIComponent(text)}`, '_blank');
}
</script>

    <script>
// 2月1日以降の直接アクセスを禁止し、終着駅ページへ飛ばす
(function() {
    const expiry = new Date("2026-02-01T00:00:00+09:00").getTime();
    if (new Date().getTime() >= expiry) {
        window.location.href = "memorial.html";
    }
})();
</script>

</body>
</html>
</body>
</html>
